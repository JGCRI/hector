<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hector">
<title>Constraints • hector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Constraints">
<meta property="og:description" content="hector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/manual.html">Manual</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting Started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../articles/BuildHector.html">Building Hector</a>
    <a class="dropdown-item" href="../articles/hector.html">Intro to Hector R interface</a>
    <a class="dropdown-item" href="../articles/Hector-Wider-World.html">Documentation manuscripts &amp; tutorials</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/hector.html">Example: Basic run and simple sensitivity anlaysis</a>
    <a class="dropdown-item" href="../articles/ex_hector_apply.html">Example: Using Hector to solve for an emissions pathway</a>
    <a class="dropdown-item" href="../articles/ex_multiple-biomes.html">Example: Running Hector with multiple biomes</a>
    <a class="dropdown-item" href="../articles/ex_carbon_tracking.html">Example: Carbon tracking with Hector</a>
    <a class="dropdown-item" href="../articles/ex_land_ocean_warming.html">Example: Changing Hector's land ocean warming ratio parameter</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JGCRI/hector">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Constraints</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/hector/blob/HEAD/vignettes/articles/Constraints.Rmd" class="external-link"><code>vignettes/articles/Constraints.Rmd</code></a></small>
      <div class="d-none name"><code>Constraints.Rmd</code></div>
    </div>

    
    
<p>The Hector model can be run subject to <em>constraints</em> that
force the model to have a certain behavior. Technically, this means that
the model’s components output user-provided data as opposed to their own
calculations, similar to the <a href="http://www.cesm.ucar.edu/models/cesm1.0/cesm/cesm_doc_1_0_4/x42.html" class="external-link">data
mode</a> of a CESM sub-model. Currently, the available constraints
include:</p>
<ul>
<li>GHG concentrations</li>
<li>Radiative forcing</li>
<li>Temperature</li>
<li>Net Biome Production (NBP)</li>
</ul>
<p>Constraints can be applied to Hector within the ini file
(command-line &amp; R) or using the Hector package <code><a href="../reference/setvar.html">setvar()</a></code>
function.</p>
<div class="section level2">
<h2 id="setting-constraints-in-hector">Setting Constraints in Hector<a class="anchor" aria-label="anchor" href="#setting-constraints-in-hector"></a>
</h2>
<p>There are two ways to activate a constraint in Hector: through an ini
file or with the <code><a href="../reference/setvar.html">setvar()</a></code> function in R. Here is a generic
overview of the two different approaches. See below for a more specific
implementation of constraints.</p>
<div class="section level3">
<h3 id="constraints-via-the-ini-file">Constraints via the ini file<a class="anchor" aria-label="anchor" href="#constraints-via-the-ini-file"></a>
</h3>
<p>A Hector <a href="InputFiles.html">input file</a> is broken up into
sections such as <code>[core]</code>, <code>[temperature]</code>,
<code>[carbon-cycle-solver]</code>, and so on. Within each section,
users can define parameter values and pass in input variables –
including constraints. All of the constraint variables are named with
the pattern <code>variable_constrain</code> that points to the csv file
where the variables’ time series are defined. When the line starts the
symbol <code>;</code>, the constraint is off and Hector is free running.
When the constraint line beings without <code>;</code>, then Hector is
using the constraint and the user-provided data is used in lieu of
Hector’s internal calculations. Changes to the constraints in the input
files apply to Hector runs executed at the command line or with the R
interface.</p>
</div>
<div class="section level3">
<h3 id="constraints-via-setvar">Constraints via <code>setvar()</code><a class="anchor" aria-label="anchor" href="#constraints-via-setvar"></a>
</h3>
<p>With the Hector R package, the <code><a href="../reference/setvar.html">setvar()</a></code> function can be
used to set constraints for a Hector instance. See below for specific
examples or run <code><a href="../reference/constraints.html">help("constraints")</a></code> or
<code><a href="../reference/haloconstrain.html">help("haloconstrain")</a></code> for the static R help
documentation.</p>
</div>
<div class="section level3">
<h3 id="discontinuous-constraints">Discontinuous constraints<a class="anchor" aria-label="anchor" href="#discontinuous-constraints"></a>
</h3>
<p>Hector <em>does not perform any interpolation of constraints</em> –
constraints are applied only in the exact years that they are provided
by the user, and all other years (including those immediately before or
after constrained years) are treated as unconstrained (typically,
emissions-driven). This means that constraints can abruptly force
Hector’s climate system into a state that is inconsistent with the
previous time step. Concentrations for the first year of a constraint
can be discontinuous compared to the previous year without a constraint.
Concentrations after the last year of a constraint will not necessarily
have a discontinuity, but the behavior of the corresponding component
and any related components may change after this point. It is the user’s
responsibility to make sure that constraints are continuous.</p>
</div>
</div>
<div class="section level2">
<h2 id="current-constraint-capabilities">Current Constraint Capabilities<a class="anchor" aria-label="anchor" href="#current-constraint-capabilities"></a>
</h2>
<div class="section level3">
<h3 id="atmospheric-co2">Atmospheric CO<sub>2</sub><a class="anchor" aria-label="anchor" href="#atmospheric-co2"></a>
</h3>
<p>CO<span class="math inline">\(_2\)</span> concentrations ([CO<span class="math inline">\(_2\)</span>], given in ppmv CO<span class="math inline">\(_2\)</span>) have the largest effect on total
radiative forcing and are affected by carbon-cycle climate interactions.
Running Hector with the CO<span class="math inline">\(_2\)</span>
concentration constraint turned on mimics the default behavior of the
Earth System Models which are GHG concentration driven. This capability
is also helpful with debugging. With the atmospheric CO<span class="math inline">\(_2\)</span> constraint turned on, carbon-cycle and
climate feedback parameters (<span class="math inline">\(Q_{10}\)</span>
and <span class="math inline">\(\beta\)</span>) are essentially
ignored.</p>
<p>Uncommenting (removing the <code>;</code>) from the following line in
the <code>[simpleNbox]</code> section of the <a href="InputFiles.html">input file</a> will turn the atmospheric CO<span class="math inline">\(_2\)</span> concentration constraint on.</p>
<pre><code>;CO2_constrain=csv:path/to/constraint/file.csv</code></pre>
<p>Then the model’s atmospheric CO<span class="math inline">\(_2\)</span> concentration ([CO<span class="math inline">\(_2\)</span>], given in ppmv CO<span class="math inline">\(_2\)</span>) will follow the contents of this file
(which must include at least two columns titled <code>Date</code> and
<code>CO2_constrain</code>). Alternatively, Hector’s atmospheric CO<span class="math inline">\(_2\)</span> concentration constraint can be set
using the <code><a href="../reference/setvar.html">setvar()</a></code> function and
<code><a href="../reference/carboncycle.html">CO2_CONSTRAIN()</a></code>.</p>
<p>Here is an example in R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up an instance of Hector &amp; run, this is the free running Hector to be</span></span>
<span><span class="co"># used as a comparison to the constrained Hector</span></span>
<span><span class="va">ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input/hector_ssp245.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span></span>
<span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">ini</span>, name <span class="op">=</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span> <span class="co"># `invisible` prevents Hector core info from being printed out</span></span>
<span></span>
<span><span class="co"># Extract the output</span></span>
<span><span class="va">dates_to_keep</span> <span class="op">&lt;-</span> <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span></span>
<span><span class="va">vars_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/carboncycle.html">ATMOSPHERIC_CO2</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/forcings.html">RF_TOTAL</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/temperature.html">GLOBAL_TAS</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">free_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a time series of new CO2 values to use as the constraint</span></span>
<span><span class="va">constraint_yrs</span> <span class="op">&lt;-</span> <span class="fl">1950</span><span class="op">:</span><span class="fl">2050</span></span>
<span><span class="va">new_co2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from  <span class="op">=</span> <span class="fl">200</span>, to <span class="op">=</span> <span class="fl">400</span>, length.out <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">constraint_yrs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use setvar() to set up the the constraint, reset and run Hector, and fetch the results</span></span>
<span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, dates <span class="op">=</span> <span class="va">constraint_yrs</span>, var <span class="op">=</span> <span class="fu"><a href="../reference/carboncycle.html">CO2_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span>, values <span class="op">=</span> <span class="va">new_co2</span>,</span>
<span>       unit <span class="op">=</span> <span class="fu"><a href="../reference/getunits.html">getunits</a></span><span class="op">(</span><span class="fu"><a href="../reference/carboncycle.html">CO2_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: ssp245</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">constrained_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span></code></pre></div>
<p>Plot results from the free running Hector with the constrained
Hector.</p>
<p><img src="Constraints_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p><strong>How the constraint is implemented in Hector
(C++)</strong></p>
<p>The CO<span class="math inline">\(_2\)</span> constraint is applied
at the <em>end</em> of the current time step. The full sequence of
events is as follows: First, the model solves the current time-step’s
carbon cycle conditioned on the previous time step’s carbon pools,
ignoring the CO<span class="math inline">\(_2\)</span> constraint. Then,
if a CO<span class="math inline">\(_2\)</span> constraint is present,
Hector calculates the difference between its calculated atmospheric
CO<span class="math inline">\(_2\)</span> and the prescribed CO<span class="math inline">\(_2\)</span> constraint. If the target atmospheric
CO<span class="math inline">\(_2\)</span> concentration is lower than
the calculated CO<span class="math inline">\(_2\)</span>, the excess
carbon is transferred from the atmosphere to the deep ocean; conversely,
if the target atmospheric CO<span class="math inline">\(_2\)</span>
concentration is greater than the calculated value, the additional
carbon is transferred from the deep ocean into the atmosphere. Finally,
Hector records the current atmospheric CO<span class="math inline">\(_2\)</span> concentration (which is now equal to
the constraint value); this is the value that is used in the next time
step’s evaluation of carbon-climate feedbacks (e.g. CO<span class="math inline">\(_2\)</span> fertilization of net primary
productivity, surface ocean carbonate chemistry…). In other words, an
atmospheric CO<span class="math inline">\(_2\)</span> constraint at time
<span class="math inline">\(t\)</span> does not affect carbon-climate
feedbacks until <span class="math inline">\(t+1\)</span>.</p>
<p>The CO<span class="math inline">\(_2\)</span> constraint need not
span the entirety of the Hector simulation, or even be continuous. At
any given time step, Hector will check whether or not a CO<span class="math inline">\(_2\)</span> constraint exists at that time step
and only apply the constraint if it is present. This means that “hybrid”
runs are possible, where only some specific time ranges have CO<span class="math inline">\(_2\)</span> constraints while others calculate the
atmospheric carbon pool and CO<span class="math inline">\(_2\)</span>
concentrations according to Hector’s standard <a href="SimpleNBox.html">carbon cycle</a>.</p>
</div>
<div class="section level3">
<h3 id="non-co2-concentrations">Non CO<sub>2</sub> concentrations<a class="anchor" aria-label="anchor" href="#non-co2-concentrations"></a>
</h3>
<p>Hector can constrain non CO<span class="math inline">\(_2\)</span>
GHG concentrations (N<span class="math inline">\(_2\)</span>O, CH<span class="math inline">\(_4\)</span>, and halocarbons). These all work in
more-or-less the same way as the atmospheric CO<span class="math inline">\(_2\)</span> constraint (above), except that there
is no equivalent to the carbon pool adjustment for these gases.</p>
<p>In the <a href="InputFiles">input file</a>, they are triggered by a
line like the following in their corresponding component section:</p>
<pre><code><span><span class="va">X_constrain</span><span class="op">=</span><span class="va">csv</span><span class="op">:</span><span class="va">path</span><span class="op">/</span><span class="va">to</span><span class="op">/</span><span class="va">file.csv</span></span></code></pre>
<p>As with other CSV inputs, the <code>/path/to/file.csv</code> above
must include columns for <code>Date</code> and
<code>X_constrain</code>.</p>
<p>Alternatively, constraints can be set from the R interface using
<code><a href="../reference/setvar.html">setvar()</a></code>. Implementing these constraints follows the same
pattern as the temperature, radiative forcing, and atmospheric CO<span class="math inline">\(_2\)</span>: Set up an active Hector core, use
<code><a href="../reference/setvar.html">setvar()</a></code> to set the constraint, run, and fetch the output
from the Hector core.</p>
<p><strong>How the constraint is implemented in Hector (C++) using
CH<sub>4</sub> as an example</strong></p>
<p>At any given time step, Hector will check if the constraint has a
value for that time step (e.g. <code>CH4_constrain.exists(t)</code>). If
the constraint exists, Hector will skip all atmospheric chemistry
calculations and set the corresponding atmospheric concentration value
to the constraint value
(e.g. <code>CH4.set(t, CH4_constrain.get(t)</code>). If the constraint
does not exist, Hector will proceed with its standard atmospheric
chemistry routines for calculating the atmospheric concentration based
on emissions and concentrations of other relevant species. This means
that <em>concentration constraints always take precedence over
emissions</em>; in other words, if a particular time step has both an
emissions and a concentration constraint, the emissions constraint is
ignored.</p>
<p>Note that CH<span class="math inline">\(_4\)</span> and N<span class="math inline">\(_2\)</span>O have special variables for their
pre-industrial concentration that could conflict with the constraint. In
Hector, <em>concentration constraints take precedence over
pre-industrial concentrations</em>; in other words, Hector assumes that
if you provide a concentration constraint for the pre-industrial
timestep, that is the concentration you want, regardless of the
prescribed pre-industrial value. The equations for CH<span class="math inline">\(_4\)</span> and N<span class="math inline">\(_2\)</span>O concentrations to radiative forcing
were parameterized with specific pre-industrial concentrations. Users
must be cautions of changes to pre-industrial values and how it may
affect the radiative forcing calculations.</p>
</div>
<div class="section level3">
<h3 id="radiative-forcing">Radiative forcing<a class="anchor" aria-label="anchor" href="#radiative-forcing"></a>
</h3>
<p>The model’s global radiative forcing <code>Ftot</code> which drives
global temperature changes can be constrained. Free running Hector
calculates <code>Ftot</code> based on the radiative forcing
contributions from GHG concentrations, aerosol emissions, and forcing
inputs [UNSURE WORDING] (e.g. land albedo and solar forcing). Using the
radiative forcing constraint <code>Ftot_constrain</code> means any
parameters and/or variables that affect radiative forcing (such as
carbon cycle feedback parameters or emissions) will not affect
<code>Ftot</code> while the constraint is in effect. The model will
extrapolate within the <code>Ftot_constrain</code> as necessary, but not
beyond its endpoints. Once Hector’s internal date passes the last date
for <code>Ftot_constrain</code>, the model’s forcing component becomes
<em>unconstrained</em>.</p>
<p>Uncommenting (removing the <code>;</code>) from the following line in
the <code>[forcing]</code> section of the <a href="InputFiles.html">input file</a> will turn the radiative forcing
constraint on.</p>
<pre><code>;Ftot_constrain=csv:path/to/constraint/file.csv</code></pre>
<p>Here is an example of using the R package to implement the radiative
forcing constraint.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up an instance of Hector &amp; run</span></span>
<span><span class="va">ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input/hector_ssp245.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span></span>
<span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">ini</span>, name <span class="op">=</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span> <span class="co"># the invisible call prevents Hector core info from being printed out</span></span>
<span></span>
<span><span class="co"># Extract the output.</span></span>
<span><span class="va">dates_to_keep</span> <span class="op">&lt;-</span> <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span></span>
<span><span class="va">vars_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/forcings.html">RF_TOTAL</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/temperature.html">GLOBAL_TAS</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">free_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a time series of new RF values to use as the RF constraint. We are only</span></span>
<span><span class="co"># going to change the RF for a subset of the years.</span></span>
<span><span class="va">new_rf</span> <span class="op">&lt;-</span> <span class="va">free_out</span><span class="op">[</span><span class="va">free_out</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="fu"><a href="../reference/forcings.html">RF_TOTAL</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">free_out</span><span class="op">$</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1950</span><span class="op">:</span><span class="fl">2050</span>, <span class="op">]</span></span>
<span><span class="va">new_rf</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="va">new_rf</span><span class="op">$</span><span class="va">value</span> <span class="op">+</span> <span class="fl">3</span> <span class="co"># increase the total RF</span></span>
<span></span>
<span><span class="co"># Use setvar() to set up the the constraint, reset and run Hector, and fetch the results.</span></span>
<span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, dates <span class="op">=</span> <span class="va">new_rf</span><span class="op">$</span><span class="va">year</span>, var <span class="op">=</span> <span class="fu"><a href="../reference/constraints.html">FTOT_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span>, values <span class="op">=</span> <span class="va">new_rf</span><span class="op">$</span><span class="va">value</span>, unit <span class="op">=</span> <span class="st">"W/m2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: ssp245</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">constrained_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span></code></pre></div>
<p>Plot the total radiative forcing and global mean temperature. Recall
the constraint is only in effect between 1950 and 2050.</p>
<p><img src="Constraints_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="temperature">Temperature<a class="anchor" aria-label="anchor" href="#temperature"></a>
</h3>
<p>Uncommenting (removing the <code>;</code>) from the following line in
the <code>[temperature]</code> section of the <a href="InputFiles.html">input file</a> will turn the global mean
constraint on.</p>
<pre><code><span><span class="va">tas_constrain</span><span class="op">=</span><span class="va">csv</span><span class="op">:</span><span class="va">path</span><span class="op">/</span><span class="va">to</span><span class="op">/</span><span class="va">constraint</span><span class="op">/</span><span class="va">file.csv</span></span></code></pre>
<p>Then the model’s global mean temperature <code>global_tas</code> will
follow the contents of this file (which must contain columns titled
<code>Date</code> and <code>tas_constrain</code>; a sample file is
included in the repository (see
<code>inst/input/tables/tgav_historical.csv</code>). The model will
extrapolate within this data as necessary, but not beyond its
endpoints.</p>
<p>Once Hector’s internal date passes the last date in the constraint
file, the model’s temperature component becomes <em>unconstrained</em>,
except that we do not permit it to suddenly jump to a new temperature.
Instead, changes in global radiative forcing (from which temperature
change is computed) are applied to the end-of-constraint temperature.
For more details, see the detailed comments in the
<code>TemperatureComponent::run</code> (temperature_component.cpp).</p>
<p>Here is an example of using the R package to implement the global
average mean temperature (<code>global_tas</code>) constraint.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set up an instance of Hector &amp; run</span></span>
<span><span class="va">ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input/hector_ssp245.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span></span>
<span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">ini</span>, name <span class="op">=</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span> <span class="co"># `invisible` prevents Hector core info from being printed</span></span>
<span></span>
<span><span class="co"># Extract the output</span></span>
<span><span class="va">dates_to_keep</span> <span class="op">&lt;-</span> <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span></span>
<span><span class="va">vars_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/temperature.html">GLOBAL_TAS</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">free_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Make a time series of new temperature values to use as the constraint</span></span>
<span><span class="va">new_tgav</span> <span class="op">&lt;-</span> <span class="va">free_out</span><span class="op">[</span><span class="va">free_out</span><span class="op">$</span><span class="va">variable</span> <span class="op">==</span> <span class="fu"><a href="../reference/temperature.html">GLOBAL_TAS</a></span><span class="op">(</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">new_tgav</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="va">new_tgav</span><span class="op">$</span><span class="va">value</span> <span class="op">+</span> <span class="va">new_tgav</span><span class="op">$</span><span class="va">value</span> <span class="op">*</span> <span class="fl">0.25</span> <span class="co"># increase global temp by 25%</span></span>
<span></span>
<span><span class="co"># Use setvar() to set up the the constraint, reset and run Hector, and fetch the results</span></span>
<span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, dates <span class="op">=</span> <span class="va">new_tgav</span><span class="op">$</span><span class="va">year</span>, var <span class="op">=</span> <span class="fu"><a href="../reference/constraints.html">TAS_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span>, values <span class="op">=</span> <span class="va">new_tgav</span><span class="op">$</span><span class="va">value</span>,</span>
<span>       unit <span class="op">=</span> <span class="fu"><a href="../reference/getunits.html">getunits</a></span><span class="op">(</span><span class="fu"><a href="../reference/constraints.html">TAS_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: ssp245</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">constrained_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span></code></pre></div>
<p>Plot the total radiative forcing and global mean temperature. Recall
the constraint is only in effect between 1950 and 2050.</p>
<p><img src="Constraints_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="nbp">NBP<a class="anchor" aria-label="anchor" href="#nbp"></a>
</h3>
<p>The NBP constraint can be activated via the ini file by adding the
line</p>
<pre><code><span><span class="va">NBP_constrain</span><span class="op">=</span><span class="va">csv</span><span class="op">:</span><span class="va">path</span><span class="op">/</span><span class="va">to</span><span class="op">/</span><span class="va">constraint</span><span class="op">/</span><span class="va">file.csv</span></span></code></pre>
<p>to the <code>[simpleNbox]</code> section of the <a href="InputFiles.html">input file</a>, where the constraint csv file has
columns titled <code>Date</code> and <code>NBP_constrain</code> similar
to the sample file is included in the repository (see
<code>inst/input/tables/tgav_historical.csv</code>).</p>
<p>Here is an example implemented in the R interface</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">constraint_yrs</span> <span class="op">&lt;-</span> <span class="fl">2001</span><span class="op">:</span><span class="fl">2010</span></span>
<span><span class="va">constraint_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="op">-</span><span class="fl">0.4</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input/hector_ssp245.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span></span>
<span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">ini</span>, name <span class="op">=</span> <span class="st">"ssp245"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span> <span class="co"># `invisible` prevents Hector core info from being printed out</span></span>
<span></span>
<span><span class="co"># Extract the output</span></span>
<span><span class="va">dates_to_keep</span> <span class="op">&lt;-</span> <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span></span>
<span><span class="va">vars_to_keep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/carboncycle.html">ATMOSPHERIC_CO2</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/carboncycle.html">NBP</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/carboncycle.html">NPP</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/carboncycle.html">RH</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">free_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use setvar() to set up the the constraint, reset and run Hector, and fetch the results</span></span>
<span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, dates <span class="op">=</span> <span class="va">constraint_yrs</span>, var <span class="op">=</span> <span class="fu"><a href="../reference/carboncycle.html">NBP_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span>, values <span class="op">=</span> <span class="va">constraint_values</span>,</span>
<span>       unit <span class="op">=</span> <span class="fu"><a href="../reference/getunits.html">getunits</a></span><span class="op">(</span><span class="fu"><a href="../reference/carboncycle.html">NBP_CONSTRAIN</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: ssp245</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">constrained_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">1850</span><span class="op">:</span><span class="fl">2100</span>, vars <span class="op">=</span> <span class="va">vars_to_keep</span><span class="op">)</span></span></code></pre></div>
<p>Plot results from the free running Hector with the constrained
Hector.</p>
<p><img src="Constraints_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The model hits the constraint exactly by raising RH and lowering NPP.
Because of this, atmospheric CO<span class="math inline">\(_2\)</span>
rises rapidly during the constraint period, as we’ve basically shut down
the land C sink. As a result, when the model exits the constraint
period, NPP shoots up very high (because the atmosphere is saturated
with CO<span class="math inline">\(_2\)</span>). In a similar vein, the
suppressed NPP means, once outside of the constraint, that RH is low and
thus the land becomes a large sink as it draws down the excess
atmospheric CO<span class="math inline">\(_2\)</span>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kalyn Dorheim, Ben Bond-Lamberty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
