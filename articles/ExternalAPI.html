<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Hector External API • hector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hector External API">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hector</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">3.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../articles/manual.html">Manual</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-getting-started" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Getting Started</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-getting-started">
<li><a class="dropdown-item" href="../articles/BuildHector.html">Building Hector</a></li>
    <li><a class="dropdown-item" href="../articles/hector.html">Intro to Hector R interface</a></li>
    <li><a class="dropdown-item" href="../articles/Hector-Wider-World.html">Documentation manuscripts &amp; tutorials</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-examples" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Examples</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-examples">
<li><a class="dropdown-item" href="../articles/hector.html">Example: Basic run and simple sensitivity anlaysis</a></li>
    <li><a class="dropdown-item" href="../articles/ex_hector_apply.html">Example: Using Hector to solve for an emissions pathway</a></li>
    <li><a class="dropdown-item" href="../articles/ex_multiple-biomes.html">Example: Running Hector with multiple biomes</a></li>
    <li><a class="dropdown-item" href="../articles/ex_carbon_tracking.html">Example: Carbon tracking with Hector</a></li>
    <li><a class="dropdown-item" href="../articles/ex_land_ocean_warming.html">Example: Changing Hector's land ocean warming ratio parameter</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JGCRI/hector"><span class="fa fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hector External API</h1>
            <h3 data-toc-skip class="subtitle">C++</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/hector/blob/v3.5.0/vignettes/articles/ExternalAPI.Rmd" class="external-link"><code>vignettes/articles/ExternalAPI.Rmd</code></a></small>
      <div class="d-none name"><code>ExternalAPI.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The Hector external API allows another program to execute one or more
Hector runs within another program. All of the functionality available
in the stand-alone version of Hector is available through the API. In
fact, stand-alone Hector is implemented as a wrapper around a series of
calls to the API. Therefore, a program using the Hector API can do all
of the following: * Set up one or more Hector instances and read
configuration files. * Set emissions values. * Run Hector through a
specified date, resuming from wherever the model last stopped. *
Retrieve current concentrations and forcings.</p>
<p>There are many ways these capabilities can be used, but our examples
will concentrate on one work flow that will be interesting to integrated
assessment (IA) model users:</p>
<ol style="list-style-type: decimal">
<li>Set up Hector.</li>
<li>Run up to the start date of the IA model using stored historical
emissions.</li>
<li>Run an IA model step.</li>
<li>Set Hector emissions from the IA model outputs.</li>
<li>Run Hector to the start of the next IA model step.</li>
<li>Read Hector outputs.</li>
<li>Repeat steps 3-6 until the desired end date is reached.</li>
</ol>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<p>The Hector API is supported in Hector version 1.1 and later. It is
written in C++. To use it, either your code must be written in C++, or
you will need some way of calling C++ functions from whatever language
you are using. The instructions here presuppose a Linux install, but the
same basic procedure, with some tweaking of file paths and so on, should
work on Windows or Mac systems.</p>
</div>
<div class="section level2">
<h2 id="installation-and-setup">Installation and Setup<a class="anchor" aria-label="anchor" href="#installation-and-setup"></a>
</h2>
<p><a href="BuildHector.html">Install and build Hector</a> normally. The
build process will produce a library called <code>libhector.a</code>.
You will need to link this file into your executable when you build your
program. If you have a place where you store all of your libraries
(e.g., <code>/usr/local/lib</code>), you can copy it there, or you can
just use it in place if you wish. You will also need to be able to
include the Hector header files in your code. They are found in the
‘headers’ directory under the directory where you installed Hector. You
could copy that entire directory tree to something like
<code>/usr/include/hector</code> if you wish, but it’s probably just as
easy to leave it where it is.</p>
<p>You don’t absolutely need any of the other files in the Hector
directories, but a few others might be useful as examples. The file
<code>src/main.cpp</code> is an example of how to use the API to get
data in and out of Hector. You can build the example code by
uncommenting these lines in the Makefile:</p>
<pre><code><span><span class="co"># hector-api: libhector.a main-api.o</span></span>
<span><span class="co">#   $(CXX) $(LDFLAGS) -o hector-api main-api.o -lhector -lgsl -lgslcblas -lm</span></span></code></pre>
<p>Then run <code>make hector-api</code> to build the example. From the
top-level Hector directory, run
<code>hector-api input/api-example.ini</code> to run the example code.
The example code reads emissions for several gases from the files in the
<code>input/emissions</code> directory and loads those emissions into
the Hector core through the API. Emissions for the remaining gases are
set from the input file, as in the stand-alone version of Hector.</p>
</div>
<div class="section level2">
<h2 id="using-the-api">Using the API<a class="anchor" aria-label="anchor" href="#using-the-api"></a>
</h2>
<p>Hector classes are (with one exception) contained in the
<code>Hector::</code> namespace. The classes needed to use the Hector
API are:</p>
<ul>
<li>
<code>Hector::Core</code> Master controller that mediates
interactions between Hector components and with outside code.</li>
<li>
<code>Hector::unitval</code> Structure for representing a numerical
value with attached units. Values that you send to and receive from
Hector will be packaged in this structure. The <code>unitval</code>
class has an implicit conversion to double defined, which strips off the
unit and returns the numerical value. Writing a <code>unitval</code> to
a <code>std::ostream</code> writes both the value and the unit
(e.g. <code>12345 Tg</code>).</li>
<li>
<code>Hector::message_data</code> Structure for holding messages for
Hector components. A <code>message_data</code> can hold a variety of
different message types, but for messages from outside of Hector, a
message will be either a date (for retrieving data from a component), or
a date paired with a <code>unitval</code> (for sending data to a
component).</li>
<li>
<code>Hector::Logger</code> Hector’s logging class. You only need to
deal with this if you want to attach loggers to Hector components.</li>
<li>
<code>Hector::INIToCoreReader</code> Helper class used during
initialization.</li>
<li>
<code>Hector::CSVOutputStreamVisitor</code> Class that formats and
writes Hector’s output. You will only need this if you want Hector to
produce its native output. If you are planning on retrieving data from
Hector and using your code’s output mechanism, you can skip it.</li>
<li>
<code>h_exception</code> Exception class. If something goes wrong
Hector will throw this class as an exception.</li>
</ul>
<p>The Hector core will be your interface for controlling and
interacting with the simulation. To run the simulation, you use the
core’s run method. To get a component to do something, you tell the
Hector core to send the component a message. The type of the message
determines what the component will do in response, and the contents of
the message provide the input for whatever it is that the component will
be doing. The core routes the message and returns the response, if
any.</p>
<p>A message comprises three parts:<br>
* A <strong>type</strong> that indicates what you want the component to
do. The types you will encounter most frequently are <em>SETDATA</em>
and <em>GETDATA</em><br>
* A <strong>target</strong> that indicates what the message is for.
Usually this will be the name of a gas or a type of forcing. Valid
targets have defined constants that are given in an [[appendix|Hector
Message Targets]].<br>
* The <strong>contents</strong> will provide the input for the
component’s action. This will be a <code>message_data</code> object that
you have packed with the relevant data.</p>
<div class="section level3">
<h3 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>The general procedure for initialization is:</p>
<ol style="list-style-type: decimal">
<li>Create an instance of <code>Hector::Core</code>.</li>
<li>Initialize the core.</li>
<li>Read and parse the configuration (INI) file.</li>
<li>
<em>(Optionally)</em> Attach an output stream visitor to
Hector.</li>
<li>Set the core ready to run.</li>
</ol>
<p>All together, the procedure looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>Hector<span class="op">::</span>Core hcore<span class="op">;</span>          <span class="co">// create the core</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>hcore<span class="op">.</span>init<span class="op">();</span>                <span class="co">// run init method</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">// create the INI reader:</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>Hector<span class="op">::</span>INIToCoreReader coreParser<span class="op">(&amp;</span>hcore<span class="op">);</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">// use it to parse an input file:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>coreParser<span class="op">.</span>parse<span class="op">(</span><span class="st">"input/myinput.ini"</span><span class="op">);</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">/* This next part is OPTIONAL. You only have to do it if you want Hector's native output */</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">// set up an output file stream</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="bu">std::</span>ofstream ofile<span class="op">(</span><span class="st">"output/my-hector-outputstream.csv"</span><span class="op">);</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">// The output stream visitor formats and creates the output. It needs</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">// the output stream we just created.</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>Hector<span class="op">::</span>CSVOutputStreamVisitor hcosv<span class="op">(&amp;</span>ofile<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">// Add the visitor to the core</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>hcore<span class="op">.</span>addVisitor<span class="op">(&amp;</span>hcosv<span class="op">);</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">/* </span><span class="re">END</span><span class="co"> of the OPTIONAL part */</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>hcore<span class="op">.</span>prepareToRun<span class="op">();</span>         <span class="co">// prepare Hector to run</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-emissions">Setting Emissions<a class="anchor" aria-label="anchor" href="#setting-emissions"></a>
</h3>
<p>To set emissions for a gas, send a <em>SETDATA</em> message targeted
at the gas you want to set emissions for. You don’t have to know which
component handles the gas; the core takes care of looking that up. The
message contents will be a date (the year you are setting emissions for)
and a <code>unitval</code> (the emissions value). Hector checks the
units on the data passed in, but it doesn’t convert on the fly. <a href="units.html">Units for the gases tracked by Hector</a> are given in
a separate appendix.</p>
<p>The entire process looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co">// emiss is a double with CO2 emissions in GtC/yr, presumably calculated elsewhere</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">// year is a double that gives the year</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">// hcore is an object of type Hector::Core</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>Hector<span class="op">::</span>unitval data<span class="op">(</span>emiss<span class="op">,</span> U_PGC_YR<span class="op">);</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>Hector<span class="op">::</span>message_data msg<span class="op">(</span>year<span class="op">,</span> data<span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>hcore<span class="op">.</span>sendMessage<span class="op">(</span>M_SETDATA<span class="op">,</span> D_ANTHRO_EMISSIONS<span class="op">,</span> msg<span class="op">);</span></span></code></pre></div>
<p>You can ignore the return value from <code>sendMessage()</code> in
this case, since the purpose of the message is to set data, not retrieve
it.</p>
<p>Emissions set using this method overwrite any previously existing
emissions for the same time and gas specified in the message. This
includes any emissions that were configured from the INI file. As a
result, it is safe to read a complete set of emissions from the INI file
(e.g., by using one of the packaged configurations) and replace the
emissions as needed. Note, however, that the emissions data packaged
with Hector are provided annually. Therefore, if your model generates
emissions at time steps of greater than one year, you will have to make
certain to overwrite the emissions at years in between your model’s time
steps, or you will get unexpected results.</p>
</div>
<div class="section level3">
<h3 id="running-the-model">Running the Model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h3>
<p>To run the model, call the <code>Hector::Core::run</code> method:</p>
<pre><code><span><span class="fu">hcore.run</span><span class="op">(</span><span class="va">stopYear</span><span class="op">)</span>;</span></code></pre>
<p>The calculation will start at the start year configured in the INI
file and will up to <em>and including</em> <code>stopYear</code>. The
practical upshot of this is that you should set the emissions for all
years up to the desired stop year before calling <code><a href="../reference/run.html">run()</a></code>.</p>
<p>Subsequent calls will resume where the previous run left off and run
up through the new stop year, so the following workflow is
supported:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">double</span> year<span class="op">=</span>model_start<span class="op">;</span> year<span class="op">&lt;=</span>model_end<span class="op">;</span> year<span class="op">+=</span>model_timestep<span class="op">)</span> <span class="op">{</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="co">// run your model here...</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="co">// set emissions from your model into Hector here...</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  hcore<span class="op">.</span>run<span class="op">(</span>year<span class="op">);</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="co">// get Hector results and do something with them here...</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>There is currently no way to make the model go backwards in time.
Attempting to run <code>Hector::run()</code> with an argument that is
less than or equal to the last stop year will produce a warning but
otherwise do nothing. Running the model past the end date configured in
the INI file will also produce a warning, but will run normally. Note,
however, that some of the components may use the configured end date in
their calculations, and they are not guaranteed to be valid after the
configured end date. Therefore, it is safest to make sure that the end
date configured in the INI file is on or after the latest date you
expect to use in your run.</p>
</div>
<div class="section level3">
<h3 id="retrieving-data">Retrieving Data<a class="anchor" aria-label="anchor" href="#retrieving-data"></a>
</h3>
<p>To retrieve results from Hector, use a <em>GETDATA</em> message. The
procedure is similar to setting emissions data; however, in this case
you will not need to supply a <code>unitval</code> argument, and you
will want to keep the return value, since it contains the value you were
retrieving.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">// retrieve CO2 concentration at the current model time</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>Hector<span class="op">::</span>unitval co2conc <span class="op">=</span> hcore<span class="op">.</span>sendMessage<span class="op">(</span>M_GETDATA<span class="op">,</span> D_ATMOSPHERIC_CO2<span class="op">);</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">// retrieve N2O concentration at specified year</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>Hector<span class="op">::</span>unitval n2oconc <span class="op">=</span> hcore<span class="op">.</span>sendMessage<span class="op">(</span>M_GETDATA<span class="op">,</span> D_ATMOSPHERIC_N2O<span class="op">,</span> year<span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">// retrieve total forcing at current model time</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>Hector<span class="op">::</span>unitval rftot <span class="op">=</span> hcore<span class="op">.</span>sendMessage<span class="op">(</span>M_GETDATA<span class="op">,</span> D_RF_TOTAL<span class="op">);</span></span></code></pre></div>
<p>There is a bit of inconsistency about the use of dates in these
calls. Generally, the date is forbidden for forcings, except for
halocarbon forcings, where it is required. Dates are forbidden for
CO<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi></mi><mn>2</mn></msub><annotation encoding="application/x-tex">_2</annotation></semantics></math>
concentrations, but required for other gases. We hope to address these
inconsistencies in subsequent updates. Note that for outputs that do not
allow a date to be supplied, the only way to get a value of the output
for a particular date is to stop the run at that date and call
<code>sendMessage()</code> to get the value for the current model
time.</p>
<p>The return value is a <code>unitval</code> structure. These can be
manipulated directly, or if they are assigned to a double, the units
will be stripped off, leaving only the value:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="dt">double</span> globaltemp <span class="op">=</span> hcore<span class="op">.</span>sendMessage<span class="op">(</span>M_GETDATA<span class="op">,</span> D_GLOBAL_TEMP<span class="op">);</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="dt">double</span> ocean_c_flux <span class="op">=</span> hcore<span class="op">.</span>sendMessage<span class="op">(</span>M_GETDATA<span class="op">,</span> D_OCEAN_C_UPTAKE<span class="op">);</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="shutdown">Shutdown<a class="anchor" aria-label="anchor" href="#shutdown"></a>
</h3>
<p>To stop the core and delete all Hector components, call the
<code><a href="../reference/shutdown.html">shutdown()</a></code> method:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>hcore<span class="op">.</span>shutdown<span class="op">();</span></span></code></pre></div>
<p>Once this method is called, all further calls to methods on the
Hector core will fail. If you have instantiated more than one Hector
core, then only the core on which <code><a href="../reference/shutdown.html">shutdown()</a></code> is called will
be affected. Others will continue to operate normally.</p>
</div>
<div class="section level3">
<h3 id="exceptions">Exceptions<a class="anchor" aria-label="anchor" href="#exceptions"></a>
</h3>
<p>If Hector encounters an unrecoverable error, it will throw an
exception with <code>h_exception</code> as the exception argument. This
object can be passed to an <code>ostream</code> to print the function,
file, and line number where the problem was detected, along with a
(hopefully) descriptive message.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c++"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  <span class="co">// do some Hector calculations...</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="cf">catch</span><span class="op">(</span><span class="at">const</span> h_exception <span class="op">&amp;</span>e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="bu">std::</span>cerr <span class="op">&lt;&lt;</span> e <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span>  <span class="co">// prints info about what went wrong</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  <span class="cf">throw</span><span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="building-and-running-your-code">Building and Running Your Code<a class="anchor" aria-label="anchor" href="#building-and-running-your-code"></a>
</h2>
<p>There are two things you have to do to build a model linked with
Hector. The first is to make sure that the compiler can find the
<code>hector.hpp</code> include file and all of the header files
included from it. You do this by adding the Hector headers directory to
your compiler’s include path. For example, if you installed Hector in
<code>/usr/src/hector</code>, then your compile command might look
something like this:</p>
<pre><code>g++ -I/usr/src/hector/headers -O -c mycode.cpp</code></pre>
<p>The second thing you have to do is to link the object files and the
Hector library, <code>libhector.a</code>. You will also need to link in
the GNU Scientific Library (GSL). Similar to the compiling step, you
have to set the library search path. You also have to add the
<code>-l</code> options of each of the needed libraries. For example,
with Hector in <code>/usr/src/hector</code> and the GSL libraries in
<code>/usr/local/lib</code>, the link command looks like this:</p>
<pre><code>g++ -L/usr/src/hector/source -L/usr/local/lib mycode.o -lhector -lgsl -lgslcblas -lm</code></pre>
<p>The Hector library is statically linked, so you won’t have to worry
about library load paths at runtime. The GSL is typically dynamically
linked, so you will need to make sure your executable can find the
library at runtime. See the [[Hector build instructions|BuildHector]]
for advice on how to arrange this.</p>
<p>If the build succeeds, then you should end up with an executable
version of your model that you can run in your usual way. Input will be
under your code’s control, so it will be up to you to supply the Hector
libraries with the name of an INI file (see instructions above). Unless
you followed the instructions to create a Hector output stream, your
code will also be responsible for producing whatever output you want
from Hector.</p>
</div>
<div class="section level2">
<h2 id="limitations-and-caveats">Limitations and Caveats<a class="anchor" aria-label="anchor" href="#limitations-and-caveats"></a>
</h2>
<ul>
<li>If you’re using a Hector output stream, and the code can’t create
the output file (e.g., because the directory doesn’t exist), then the
output will be silently discarded. The same is true of the Hector log
files.</li>
<li>There is currently no way to rewind a Hector simulation to an
earlier time. If you want to do that, you have to shut down the Hector
core and instantiate and initialize a whole new core. The new core won’t
know anything about the emissions you put into the old core, so if you
want it to follow the same emissions pathway up to the rewind point,
your code will have to store those emissions and add them to the new
core after it is initialized. Then you can run Hector up to the point
that you wanted to rewind to.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kalyn Dorheim, Ben Bond-Lamberty.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
