<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A tour of the Hector R interface • hector</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="A tour of the Hector R interface">
<meta property="og:description" content="hector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hector</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/manual/index.html">Manual</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-to-hector.html">A tour of the Hector R interface</a>
    </li>
    <li>
      <a href="../articles/hector_apply.html">Example: Using Hector to solve for an emissions pathway</a>
    </li>
    <li>
      <a href="../articles/multiple-biomes.html">Example: Running Hector with multiple biomes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JGCRI/hector" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="intro-to-hector_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A tour of the Hector R interface</h1>
                        <h4 data-toc-skip class="author">Alexey Shiklomanov</h4>
            
            <h4 data-toc-skip class="date">2018-10-17</h4>
      
      
      <div class="hidden name"><code>intro-to-hector.Rmd</code></div>

    </div>

    
    
<p>This vignette provides a basic introduction for running Hector with R. First, it shows how to do a simple Hector run with one of Hector’s built-in scenarios. Then, it shows how to modify Hector parameters from within R and uses this functionality to perform a simple sensitivity analysis of how the CO<span class="math inline">\(_2\)</span> fertilization parameter <span class="math inline">\(\beta\)</span> affects several Hector output variables.</p>
<div class="section level2">
<h2 id="basic-run">Basic run<a class="anchor" aria-label="anchor" href="#basic-run"></a>
</h2>
<p>First, load the <code>hector</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">hector</span><span class="op">)</span> </span></code></pre></div>
<p>Hector is configured via an INI file, which defines run metadata, inputs (e.g. emissions scenarios), and parameters. For details on this file, see <a href="https://github.com/JGCRI/hector/wiki/InputFiles" class="external-link">InputFiles</a> on the Hector GitHub Wiki.</p>
<p>These files ship with the Hector R package, in the <code>input</code> subdirectory, which allows them to be accessed via <code>system.file</code>. Below, we get the path of the input file corresponding to the scenario RCP 4.5.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ini_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input/hector_rcp45.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span> </span></code></pre></div>
<p>Alternatively, users may provide a path to an ini file external to the Hector package on their local machine. This ini file must comply with the Hector <a href="https://github.com/JGCRI/hector/wiki/InputFiles" class="external-link">ini requirements</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">external_ini_file</span> <span class="op">&lt;-</span> <span class="st">"/path/to/ini/on/local/machine/my_ini.ini"</span></span></code></pre></div>
<p>Next, we initialize a Hector instance, or “core”, using this configuration. This core is a self-contained object that contains information about all of Hector’s inputs and outputs. The core is initialized via the <code>newcore</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">ini_file</span><span class="op">)</span></span>
<span><span class="va">core</span> </span></code></pre></div>
<pre><code><span><span class="co">## Hector core: unnamed hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /Users/runner/work/_temp/Library/hector/input/hector_rcp45.ini</span></span></code></pre>
<p>Now that we have configured a Hector core, we can run it with the <code>run</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Hector core: unnamed hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /Users/runner/work/_temp/Library/hector/input/hector_rcp45.ini</span></span></code></pre>
<p>Notice that this itself returns no output. Instead, the output is stored inside the core object. To retrieve it, we use the <code>fetchvars</code> function. Below, we also specify that we want to retrieve results for the years 2000 to 2300.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">2000</span><span class="op">:</span><span class="fl">2300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##              scenario year variable    value    units</span></span>
<span><span class="co">## 1 unnamed hector core 2000       Ca 353.0744 ppmv CO2</span></span>
<span><span class="co">## 2 unnamed hector core 2001       Ca 354.6760 ppmv CO2</span></span>
<span><span class="co">## 3 unnamed hector core 2002       Ca 356.3236 ppmv CO2</span></span>
<span><span class="co">## 4 unnamed hector core 2003       Ca 358.0162 ppmv CO2</span></span>
<span><span class="co">## 5 unnamed hector core 2004       Ca 359.7927 ppmv CO2</span></span>
<span><span class="co">## 6 unnamed hector core 2005       Ca 361.7058 ppmv CO2</span></span></code></pre>
<p>The results are returned as a long <code>data.frame</code>. This makes it easy to plot them using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-to-hector_files/figure-html/plot-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="setting-parameters">Setting parameters<a class="anchor" aria-label="anchor" href="#setting-parameters"></a>
</h2>
<p>The Hector R interface interacts with parameters and variables in the same way. Therefore, the variables can be set and checked via <code>setvar</code> and <code>fetchvars</code>, respectively.</p>
<p>First, let’s get the current value of <span class="math inline">\(\beta\)</span> (beta), the CO<span class="math inline">\(_2\)</span> fertilization factor. Because variables and parameter names have to be retrieved from the Hector core, they are stored as R functions (e.g. <code><a href="../reference/parameters.html">BETA()</a></code>). However, these functions simply return a string corresponding to the variable name.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "beta"</span></span></code></pre>
<p>Just as we did to load results, we use <code>fetchvars</code> to query parameter values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta</span> </span></code></pre></div>
<pre><code><span><span class="co">##              scenario year variable value      units</span></span>
<span><span class="co">## 1 unnamed hector core   NA     beta  0.36 (unitless)</span></span></code></pre>
<p>The result of <code>fetchvars</code> is always a <code>data.frame</code> with the same columns, even when returning a parameter value. Note also the use of <code>NA</code> in the second argument (<code>dates</code>).</p>
<p>The current value is set to 0.36 (note that it is a unitless quantity, hence the <code>(unitless)</code> unit). Let’s bump it up a little to 0.40.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0.40</span>, <span class="st">"(unitless)"</span><span class="op">)</span> </span></code></pre></div>
<p>Similarly to <code>run</code>, this returns no output. Rather, the change is stored inside the Hector “core” object. We can confirm that our change took effect with another call to <code>fetchvars</code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##              scenario year variable value      units</span></span>
<span><span class="co">## 1 unnamed hector core   NA     beta   0.4 (unitless)</span></span></code></pre>
<p>Now, let’s run the simulation again with a higher value for CO<span class="math inline">\(_2\)</span> fertilization. But, before we do, let’s look once again at the Hector <code>core</code> object.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">core</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: unnamed hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /Users/runner/work/_temp/Library/hector/input/hector_rcp45.ini</span></span></code></pre>
<p>Notice that <code>Current date</code> is set to 2300. This is because we have already run this core to its end date. The ability to stop and resume Hector runs with the same configuration, possibly with adjusting values of certain variables while stopped, is an essential part of the model’s functionality. But, it’s not something we’re interested in here. We have already stored the previous run’s output in <code>results</code> above, so we can safely reset the core here.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: unnamed hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /Users/runner/work/_temp/Library/hector/input/hector_rcp45.ini</span></span></code></pre>
<p>This will effectively “rewind” the core back to either the provided <code>date</code> (defaults to 0 if missing) or the model start date (set in the INI file; default is 1745), whichever is greater. In addition, if the <code>date</code> argument is less than the model start date and spinup is enabled (<code>do_spinup = 1</code> in the INI file), then the core will re-do its spinup process with the current set of parameters.</p>
<hr>
<p><strong>NOTE</strong></p>
<p>Prior to a normal run beginning in 1745, Hector has an optional “spinup” mode where it runs the carbon cycle with no perturbations until it stabilizes. Essentially, the model removes human emissions and runs until there are no more changes in the carbon pools and the system has reached equilibrium.</p>
<p>Because changing Hector parameters can change the post-spinup equilibrium values of state variables, Hector will automatically run <code>reset(core, date = 0)</code> at the beginning of the next <code>run</code> call if it detects that any of its parameters have changed. This means that is not currently possible to change Hector <em>parameters</em> (such as <span class="math inline">\(\beta\)</span> or preindustrial CO<sub>2</sub>) part-way through a run. However, it is still possible to change the values of certain <em>drivers</em> and <em>state variables</em> (such as the CO<sub>2</sub> emissions) in the middle of a run.</p>
<hr>
<p>So, as a result of the <code>reset</code> command, the core’s <code>Current Date</code> is now the model start date–1745. We can now perform another run with the new CO<span class="math inline">\(_2\)</span> fertilization value.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: unnamed hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /Users/runner/work/_temp/Library/hector/input/hector_rcp45.ini</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_40</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">2000</span><span class="op">:</span><span class="fl">2300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_40</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##              scenario year variable    value    units</span></span>
<span><span class="co">## 1 unnamed hector core 2000       Ca 350.6232 ppmv CO2</span></span>
<span><span class="co">## 2 unnamed hector core 2001       Ca 352.1657 ppmv CO2</span></span>
<span><span class="co">## 3 unnamed hector core 2002       Ca 353.7535 ppmv CO2</span></span>
<span><span class="co">## 4 unnamed hector core 2003       Ca 355.3855 ppmv CO2</span></span>
<span><span class="co">## 5 unnamed hector core 2004       Ca 357.1007 ppmv CO2</span></span>
<span><span class="co">## 6 unnamed hector core 2005       Ca 358.9513 ppmv CO2</span></span></code></pre>
<p>Let’s see how changing the CO<span class="math inline">\(_2\)</span> fertilization affects our results.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">[[</span><span class="st">"beta"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.36</span></span>
<span><span class="va">results_40</span><span class="op">[[</span><span class="st">"beta"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.40</span></span>
<span><span class="va">compare_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">results_40</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">compare_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="intro-to-hector_files/figure-html/compare-co2-fert-1.png" width="700"></p>
<p>As expected, increasing CO<span class="math inline">\(_2\)</span> fertilization increases the strength of the terrestrial carbon sink and therefore reduces atmospheric CO<span class="math inline">\(_2\)</span>, radiative forcing, and global temperature. However, the effects only become pronounced in the latter half of the 21st Century.</p>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">Sensitivity analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<p>Hector runs fairly quickly, which makes it easy to run lots of simulations under slightly different configurations. One application of this is to explore the sensitivity of Hector to variability in its parameters.</p>
<p>The basic procedure for this is the same as in the previous section. However, to save typing (and, in general, to be good programmers!), let’s create some functions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Run Hector with a parameter set to a particular value, and return results </span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param core Hector core to use for execution</span></span>
<span><span class="co">#' @param parameter Hector parameter name, as a function call (e.g.</span></span>
<span><span class="co">#'   `BETA()`)</span></span>
<span><span class="co">#' @param value Parameter value</span></span>
<span><span class="co">#' @param dates Sequence of years for running simulation (default = #'</span></span>
<span><span class="co">#'   `2000:2300`)</span></span>
<span><span class="co">#' @param ini_file Hector parameter file (default = RCP 4.5 file)</span></span>
<span><span class="co">#' @return Results, as data.frame, with additional `parameter_value`</span></span>
<span><span class="co">#'   column</span></span>
<span><span class="va">run_with_param</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">core</span>, <span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">old_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="va">parameter</span><span class="op">)</span></span>
<span>  <span class="va">unit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">old_value</span><span class="op">[[</span><span class="st">"units"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="va">parameter</span>, <span class="va">value</span>, <span class="va">unit</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">2000</span><span class="op">:</span><span class="fl">2300</span><span class="op">)</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"parameter_value"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Run Hector with a range of parameter values</span></span>
<span><span class="va">run_with_param_range</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">core</span>, <span class="va">parameter</span>, <span class="va">values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">run_with_param</span><span class="op">(</span><span class="va">core</span>, <span class="va">parameter</span>, <span class="va">x</span><span class="op">)</span>, <span class="va">values</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">mapped</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sensitivity_beta</span> <span class="op">&lt;-</span> <span class="fu">run_with_param_range</span><span class="op">(</span><span class="va">core</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sensitivity_beta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">parameter_value</span>, group <span class="op">=</span> <span class="va">parameter_value</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="intro-to-hector_files/figure-html/functions-1.png" width="700"></p>
<p>As we can see, the ability of CO<span class="math inline">\(_2\)</span> fertilization to offset carbon emissions is saturating – at high values of <span class="math inline">\(\beta\)</span>, the same increase in <span class="math inline">\(\beta\)</span> translates into a smaller decrease in atmospheric CO<span class="math inline">\(_2\)</span> and related climate effects.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert Link, Kalyn Dorheim.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'b2aa343d0c9e9ed33c9582908f3acaf8',
    indexName: 'hector',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
