<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Constraints • hector</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Constraints">
<meta property="og:description" content="hector">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">hector</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/manual/index.html">Manual</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/intro-to-hector.html">A tour of the Hector R interface</a>
    </li>
    <li>
      <a href="../../articles/hector_apply.html">Example: Using Hector to solve for an emissions pathway</a>
    </li>
    <li>
      <a href="../../articles/multiple-biomes.html">Example: Running Hector with multiple biomes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JGCRI/hector">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Constraints</h1>
            
      
      
      <div class="hidden name"><code>Constraints.Rmd</code></div>

    </div>

    
    
<p>The Hector model can be run subject to <em>constraints</em> that force the model to have certain behavior. Technically, this means that the model’s components output user-provided data as opposed to their own calculations, similar to the <a href="http://www.cesm.ucar.edu/models/cesm1.0/cesm/cesm_doc_1_0_4/x42.html">data mode</a> of a CESM sub-model. Currently the available constraints include:</p>
<div id="temperature" class="section level1">
<h1 class="hasAnchor">
<a href="#temperature" class="anchor"></a>Temperature</h1>
<p>If the current <a href="InputFiles.html">input file</a> includes, in its <code>[temperature]</code> section, a line of form</p>
<pre><code>tgav_constrain=csv:path/to/constraint/file.csv</code></pre>
<p>then the model’s global mean temperature <code>Tgav</code> will follow this contents of this file (which should have two columns, <code>Date</code> and <code>tgav_constrain</code>; a sample file is included in the repository). The model will extrapolate within this data as necessary, but not beyond its endpoints.</p>
<p>Once Hector’s internal date passes the last date in the constraint file, the model’s temperature component becomes <em>unconstrained</em>, except that we do not permit it to suddenly jump to a new temperature. Instead, changes in global radiative forcing (from which temperature change is computed) are applied to the end-of-constraint temperature. For more details, see the detailed comments in the <code>TemperatureComponent::run</code> method.</p>
</div>
<div id="radiative-forcing" class="section level1">
<h1 class="hasAnchor">
<a href="#radiative-forcing" class="anchor"></a>Radiative forcing</h1>
<p>If the current <a href="InputFiles.html">input file</a> includes, in its <code>[forcing]</code> section, a line of form</p>
<pre><code>Ftot_constrain=csv:path/to/constraint/file.csv</code></pre>
<p>then the model’s global radiative forcing <code>Ftot</code>, that drives global temperature changes, will follow this contents of this file (which should have two columns, <code>Date</code> and <code>Ftot_constrain</code>). The model will extrapolate within this data as necessary, but not beyond its endpoints. Once Hector’s internal date passes the last date in the constraint file, the model’s forcing component becomes <em>unconstrained</em>.</p>
</div>
<div id="ocean-c-uptake" class="section level1">
<h1 class="hasAnchor">
<a href="#ocean-c-uptake" class="anchor"></a>Ocean C uptake</h1>
<p>If the current <a href="InputFiles.html">input file</a> includes, in its <code>[ocean]</code> section, a line of form</p>
<pre><code>oceanflux_constrain=csv:path/to/constraint/file.csv</code></pre>
<p>then the model’s ocean carbon uptake (in Pg C) will follow this contents of this file (which should have two columns, <code>Date</code> and <code>oceanflux_constrain</code>). The model will extrapolate within this data as necessary, but not beyond its endpoints. Once Hector’s internal date passes the last date in the constraint file, the model’s ocean uptake becomes <em>unconstrained</em>.</p>
</div>
<div id="atmospheric-co2" class="section level1">
<h1 class="hasAnchor">
<a href="#atmospheric-co2" class="anchor"></a>Atmospheric CO2</h1>
<p>If the current <a href="InputFiles">input file</a> includes, in its <code>[simpleNbox]</code> section, a line of form</p>
<pre><code>CO2_constrain=csv:path/to/constraint/file.csv</code></pre>
<p>then the model’s atmospheric CO2 concentration ([CO2], given in ppmv CO2) will follow the contents of this file (which should have two columns, <code>Date</code> and <code>CO2_constrain</code>). Alternatively, Hector’s atmospheric CO2 concentration constraint can be set using the <code>setvars</code> function and <code>CO2_CONSTRAIN</code> variable.</p>
<p>The CO2 constraint is applied at the <em>end</em> of the current time step. The full sequence of events is as follows: First, the model solves the current time-step’s carbon cycle conditioned on the previous time step’s carbon pools, ignoring the CO2 constraint. Then, if a CO2 constraint is present, Hector calculates the difference between its calculated atmospheric CO2 and the prescribed CO2 constraint. If the target atmospheric CO2 concentration is lower than the calculated CO2, the excess carbon is transferred from the atmosphere to the deep ocean; conversely, if the target atmospheric CO2 concentration is greater than the calculated value, the additional carbon is transferred from the deep ocean into the atmosphere. Finally, Hector records the current atmospheric CO2 concentration (which is now equal to the constraint value); this is the value that is used in the next time step’s evaluation of carbon-climate feedbacks (e.g. CO2 fertilization of net primary productivity, surface ocean carbonate chemistry). In other words, an atmospheric CO2 constraint at time <span class="math inline">\(t\)</span> does not affect carbon-climate feedbacks until <span class="math inline">\(t+1\)</span>.</p>
<p>The CO2 constraint need not span the entirety of the Hector simulation, or even be continuous. At any given time step, Hector will check whether or not a CO2 constraint exists at that time step and only apply the constraint if it is present. This means that “hybrid” runs are possible, where only some specific time ranges have CO2 constraints while others calculate the atmospheric carbon pool and CO2 concentrations according to Hector’s standard <a href="SimpleNBox">carbon cycle</a>.</p>
</div>
<div id="ch4-n2o-and-halocarbon-concentrations" class="section level1">
<h1 class="hasAnchor">
<a href="#ch4-n2o-and-halocarbon-concentrations" class="anchor"></a>CH4, N2O, and halocarbon concentrations</h1>
<p>These all work in more-or-less the same way, and are similar to the atmospheric CO2 constraint (above), except that there is no equivalent to the carbon pool adjustment for these gases. In the <a href="InputFiles">input file</a>, they are triggered by a line like the following in their corresponding component section:</p>
<pre><code>CH4_constrain=csv:path/to/file.csv</code></pre>
<p>As with other CSV inputs, the <code>/path/to/file.csv</code> above must have columns <code>Date</code> and <code>CH4_constrain</code>. Alternatively, constraints can be set from the R interface:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># library(hector)</span>
<span class="co"># core &lt;- newcore("/path/to/input/file.ini")</span>
<span class="fu"><a href="../../reference/setvar.html">setvar</a></span>(<span class="no">core</span>, <span class="fl">1900</span>:<span class="fl">2000</span>, <span class="fu"><a href="../../reference/constraints.html">CH4_CONSTRAIN</a></span>(), <span class="fl">750</span>, <span class="fu"><a href="../../reference/getunits.html">getunits</a></span>(<span class="fu"><a href="../../reference/constraints.html">CH4_CONSTRAIN</a></span>()))</pre></body></html></div>
<p>Constraints are applied as follows: At any given time step, Hector will check if the constraint has a value for that time step (e.g. <code>CH4_constrain.exists(t)</code>). If the constraint exists, Hector will skip all atmospheric chemistry calculates and set the corresponding atmospheric concentration value to the constraint value (e.g. <code>CH4.set(t, CH4_constrain.get(t)</code>). If the constraint does not exist, Hector will proceed with its standard atmospheric chemistry routines for calculating the atmospheric concentration based on emissions and concentrations of other relevant species. This means that <em>concentration constraints always take precedence over emissions</em>; in other words, if a particular time step has both emissions and a concentration constraint, the emissions are ignored.</p>
<p>Note that CH4 and N2O have special variables for their pre-industrial concentration that could conflict with the constraint. In Hector, <em>concentration constraints take precedence over pre-industrial concentrations</em>; in other words, Hector assumes that if you provide a concentration constraint for the pre-industrial timestep, that is the concentration you want, regardless of the prescribed pre-industrial value.</p>
</div>
<div id="discontinuous-constraints" class="section level1">
<h1 class="hasAnchor">
<a href="#discontinuous-constraints" class="anchor"></a>Discontinuous constraints</h1>
<p>Hector <em>does not perform any interpolation of constraints</em> – they are applied only in the exact years that they are provided by the user, and all other years are treated (including those immediately before or after constrained years) are treated as unconstrained (typically, emissions-driven). This means that constraints can abruptly force Hector’s climate system into state that is inconsistent with the previous time step. Concentrations for the first year of a constraint can be discontinuous compared to the previous year without a constraint. Concentrations after the last year of a constraint will not necessarily have a discontinuity, but the behavior of the corresponding component and any related components may change after this point. It is the user’s responsibility to make sure that constraints are continuous.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robert Link, Corinne Hartin, Ben Bond-Lamberty, Pralit Patel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
