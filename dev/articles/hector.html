<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hector">
<title>hector • hector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="hector">
<meta property="og:description" content="hector">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hector</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.9.0.0009</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/manual.html">Manual</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting Started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../articles/BuildHector.html">Building Hector</a>
    <a class="dropdown-item" href="../articles/hector.html">Intro to Hector R interface</a>
    <a class="dropdown-item" href="../articles/Hector-Wider-World.html">Documentation manuscripts &amp; tutorials</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/hector.html">Example: Basic run and simple sensitivity anlaysis</a>
    <a class="dropdown-item" href="../articles/ex_hector_apply.html">Example: Using Hector to solve for an emissions pathway</a>
    <a class="dropdown-item" href="../articles/ex_multiple-biomes.html">Example: Running Hector with multiple biomes</a>
    <a class="dropdown-item" href="../articles/ex_carbon_tracking.html">Example: Carbon tracking with Hector</a>
    <a class="dropdown-item" href="../articles/ex_land_ocean_warming.html">Example: Changing Hector's land ocean warming ratio parameter</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JGCRI/hector">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>hector</h1>
                        <h4 data-toc-skip class="author">Alexey
Shiklomanov</h4>
            
            <h4 data-toc-skip class="date">2018-10-17 (updated
2022)</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/hector/blob/HEAD/vignettes/hector.Rmd" class="external-link"><code>vignettes/hector.Rmd</code></a></small>
      <div class="d-none name"><code>hector.Rmd</code></div>
    </div>

    
    
<p>This vignette provides a basic introduction for running Hector with
R, assuming that Hector is already installed. First, it shows how to do
a simple Hector run with a built-in scenario. It then demonstrates how
to modify Hector parameters from within R to perform a simple
sensitivity analysis of how the CO<span class="math inline">\(_2\)</span> fertilization parameter <span class="math inline">\(\beta\)</span> affects several Hector output
variables.</p>
<div class="section level2">
<h2 id="basic-run">Basic run<a class="anchor" aria-label="anchor" href="#basic-run"></a>
</h2>
<p>First, load the <code>hector</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/hector" class="external-link">hector</a></span><span class="op">)</span></span></code></pre></div>
<p>Hector is configured via an INI file, which defines run metadata,
inputs (e.g., emissions scenarios), and parameters. For details on this
file, see <a href="InputFiles.html">InputFiles</a>.</p>
<p>These files ship with the Hector R package in the <code>input/</code>
subdirectory, which allows them to be accessed via
<code>system.file</code>. First, determine the path of the input file
(ini) corresponding to the scenario <a href="https://en.wikipedia.org/wiki/Shared_Socioeconomic_Pathways" class="external-link">SPP245</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ini_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input/hector_ssp245.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, users may provide a path to an ini file external to
the Hector package on their local machine. This file must comply with
the Hector <a href="InputFiles.html">ini requirements</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">external_ini_file</span> <span class="op">&lt;-</span> <span class="st">"/path/to/ini/on/local/machine/my_ini.ini"</span></span></code></pre></div>
<p>Next, we initialize a Hector instance, or “core”, using this
configuration. This core is a self-contained object that contains
information about all of Hector’s inputs and outputs. The core is
initialized via the <code>newcore</code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">ini_file</span><span class="op">)</span></span>
<span><span class="va">core</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: Unnamed Hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<p>Now that we have configured a Hector core, we can run it with the
<code>run</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: Unnamed Hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<p>Notice that this itself returns no output. Instead, the output is
stored inside the core object. To retrieve it, we use the
<code><a href="../reference/fetchvars.html">fetchvars()</a></code> function. Below, we also specify that we want
to retrieve results from 2000 to 2300.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">2000</span><span class="op">:</span><span class="fl">2300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              scenario year          variable    value    units</span></span>
<span><span class="co">## 1 Unnamed Hector core 2000 CO2_concentration 369.0965 ppmv CO2</span></span>
<span><span class="co">## 2 Unnamed Hector core 2001 CO2_concentration 370.8101 ppmv CO2</span></span>
<span><span class="co">## 3 Unnamed Hector core 2002 CO2_concentration 372.4475 ppmv CO2</span></span>
<span><span class="co">## 4 Unnamed Hector core 2003 CO2_concentration 374.1880 ppmv CO2</span></span>
<span><span class="co">## 5 Unnamed Hector core 2004 CO2_concentration 375.9842 ppmv CO2</span></span>
<span><span class="co">## 6 Unnamed Hector core 2005 CO2_concentration 378.0061 ppmv CO2</span></span></code></pre>
<p>The results are returned as a long <code>data.frame</code>. This
makes it easy to plot them using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span></code></pre></div>
<p><img src="hector_files/figure-html/plot-1.png" width="1093.75"></p>
<p>By default, <code><a href="../reference/fetchvars.html">fetchvars()</a></code> returns the four outputs shown
above – atmospheric CO<span class="math inline">\(_2\)</span>
concentration, CO<span class="math inline">\(_2\)</span> radiative
forcing, total radiative forcing, and temperature change – but any model
output(s) can be specified.</p>
</div>
<div class="section level2">
<h2 id="setting-parameters">Setting parameters<a class="anchor" aria-label="anchor" href="#setting-parameters"></a>
</h2>
<p>The Hector R interface interacts with parameters and variables in the
same way. Therefore, the variables can be set and checked via
<code><a href="../reference/setvar.html">setvar()</a></code> and <code><a href="../reference/fetchvars.html">fetchvars()</a></code>.</p>
<p>First, let’s get the current value of <span class="math inline">\(\beta\)</span> (beta), the CO<span class="math inline">\(_2\)</span> fertilization factor. Because
variables and parameter names have to be retrieved from the Hector core,
they are stored as R functions (e.g. <code><a href="../reference/parameters.html">BETA()</a></code>). However,
these functions return a string corresponding to the variable name.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "beta"</span></span></code></pre>
<p>Just as we did to load results, we use <code><a href="../reference/fetchvars.html">fetchvars()</a></code> to
query parameter values.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">beta</span></span></code></pre></div>
<pre><code><span><span class="co">##              scenario year variable value      units</span></span>
<span><span class="co">## 1 Unnamed Hector core   NA     beta  0.55 (unitless)</span></span></code></pre>
<p>The result of <code><a href="../reference/fetchvars.html">fetchvars()</a></code> is always a
<code>data.frame</code> with the same columns, even when returning a
parameter value. Note also the use of <code>NA</code> in the second
argument (<code>dates</code>).</p>
<p>The current value is set to 0.36 (note that it is a unitless
quantity, hence the <code>(unitless)</code> unit). Let’s bump it up a
little to 0.40.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">0.40</span>, <span class="st">"(unitless)"</span><span class="op">)</span></span></code></pre></div>
<p>Similarly to <code>run</code>, this returns no output. Rather, the
change is stored inside the Hector “core” object. We can confirm that
our change took effect with another call to
<code><a href="../reference/fetchvars.html">fetchvars()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              scenario year variable value      units</span></span>
<span><span class="co">## 1 Unnamed Hector core   NA     beta   0.4 (unitless)</span></span></code></pre>
<p>Now, let’s run the simulation again with a higher value for CO<span class="math inline">\(_2\)</span> fertilization. But, before we do,
let’s look once again at the Hector <code>core</code> object.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">core</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: Unnamed Hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<p>Notice that <code>Current date</code> is set to 2300. This is because
we have already run this core to its end date. The ability to stop and
resume Hector runs with the same configuration, possibly with adjusting
values of certain variables while stopped, is an essential part of the
model’s functionality. But, it’s not something we’re interested in here.
We have already stored the previous run’s output in <code>results</code>
above, so we can safely reset the core:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: Unnamed Hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    1745</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<p>This effectively ‘rewinds’ the core back to either the provided
<code>date</code> (defaults to 0 if missing) or the model start date
(set in the INI file; default is 1745), whichever is greater. In
addition, if the <code>date</code> argument is less than the model start
date and spinup is enabled (<code>do_spinup = 1</code> in the INI file),
then the core will re-do its spinup process with the current set of
parameters.</p>
<hr>
<p><strong>NOTE</strong></p>
<p>Prior to a normal run beginning in 1745, Hector has an optional
“spinup” mode where it runs the carbon cycle with no perturbations until
it stabilizes. Essentially, the model removes human emissions and runs
until there are no more changes in the carbon pools and the system has
reached equilibrium.</p>
<p>Because changing Hector parameters can change the post-spinup
equilibrium values of state variables, Hector will automatically run
<code>reset(core, date = 0)</code> at the beginning of the next
<code>run</code> call if it detects that any of its parameters have
changed. This means that it is not currently possible to change Hector
<em>parameters</em> (such as <span class="math inline">\(\beta\)</span>
or preindustrial CO<sub>2</sub>) part-way through a run. However, it is
still possible to change the values of specific <em>drivers</em> and
<em>state variables</em> (such as the CO<sub>2</sub> emissions) in the
middle of a run.</p>
<hr>
<p>So, as a result of the <code>reset</code> command, the core’s
<code>Current Date</code> is now the model start date – 1745. We can now
perform another run with the new CO<span class="math inline">\(_2\)</span> fertilization value.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: Unnamed Hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_40</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">2000</span><span class="op">:</span><span class="fl">2300</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">results_40</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              scenario year          variable    value    units</span></span>
<span><span class="co">## 1 Unnamed Hector core 2000 CO2_concentration 382.0691 ppmv CO2</span></span>
<span><span class="co">## 2 Unnamed Hector core 2001 CO2_concentration 384.0710 ppmv CO2</span></span>
<span><span class="co">## 3 Unnamed Hector core 2002 CO2_concentration 386.0025 ppmv CO2</span></span>
<span><span class="co">## 4 Unnamed Hector core 2003 CO2_concentration 388.0425 ppmv CO2</span></span>
<span><span class="co">## 5 Unnamed Hector core 2004 CO2_concentration 390.1443 ppmv CO2</span></span>
<span><span class="co">## 6 Unnamed Hector core 2005 CO2_concentration 392.4753 ppmv CO2</span></span></code></pre>
<p>Let’s see how changing the CO<span class="math inline">\(_2\)</span>
fertilization affects our results.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results</span><span class="op">[[</span><span class="st">"beta"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.36</span></span>
<span><span class="va">results_40</span><span class="op">[[</span><span class="st">"beta"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.40</span></span>
<span><span class="va">compare_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">results_40</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">compare_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="hector_files/figure-html/compare-co2-fert-1.png" width="1093.75"></p>
<p>As expected, increasing CO<span class="math inline">\(_2\)</span>
fertilization increases the strength of the terrestrial carbon sink and
therefore reduces atmospheric CO<span class="math inline">\(_2\)</span>,
radiative forcing, and global temperature. However, the effects only
become pronounced in the latter half of the 21st century.</p>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">Sensitivity analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<p>Hector runs quickly, making it easy to run many simulations under
slightly different configurations. One application of this is to explore
the sensitivity of Hector to variability in its parameters.</p>
<p>The basic procedure for this is the same as in the previous section.
However, to save typing (and, in general, to be good programmers!),
let’s create some functions.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Run Hector with a parameter set to a particular value, and return results</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param core Hector core to use for execution</span></span>
<span><span class="co">#' @param parameter Hector parameter name, as a function call (e.g. `BETA()`)</span></span>
<span><span class="co">#' @param value Parameter value</span></span>
<span><span class="co">#' @return Results, as data.frame, with additional `parameter_value` column</span></span>
<span><span class="va">run_with_param</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">core</span>, <span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="va">parameter</span>, <span class="va">value</span>, <span class="fu"><a href="../reference/getunits.html">getunits</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="fl">2000</span><span class="op">:</span><span class="fl">2300</span><span class="op">)</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"parameter_value"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span>  <span class="va">result</span><span class="op">[[</span><span class="st">"parameter_units"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getunits.html">getunits</a></span><span class="op">(</span><span class="va">parameter</span><span class="op">)</span></span>
<span>  <span class="va">result</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' Run Hector with a range of parameter values</span></span>
<span><span class="va">run_with_param_range</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">core</span>, <span class="va">parameter</span>, <span class="va">values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mapped</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">run_with_param</span><span class="op">(</span><span class="va">core</span>, <span class="va">parameter</span>, <span class="va">x</span><span class="op">)</span>, <span class="va">values</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">mapped</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sensitivity_beta</span> <span class="op">&lt;-</span> <span class="fu">run_with_param_range</span><span class="op">(</span><span class="va">core</span>, <span class="fu"><a href="../reference/parameters.html">BETA</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sensitivity_beta</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">parameter_value</span>, group <span class="op">=</span> <span class="va">parameter_value</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html" class="external-link">guide_colorbar</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="hector_files/figure-html/functions-1.png" width="1093.75"></p>
<p>As we can see, the ability of CO<span class="math inline">\(_2\)</span> fertilization to offset carbon
emissions saturates, at high values of <span class="math inline">\(\beta\)</span>, the same increase in <span class="math inline">\(\beta\)</span> translates into a smaller decrease
in atmospheric CO<span class="math inline">\(_2\)</span> and related
climate effects.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kalyn Dorheim, Ben Bond-Lamberty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
