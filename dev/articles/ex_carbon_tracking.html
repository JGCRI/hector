<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="hector">
<title>Carbon tracking with Hector • hector</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Carbon tracking with Hector">
<meta property="og:description" content="hector">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">hector</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.9.0.0009</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/manual.html">Manual</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-getting-started">Getting Started</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-getting-started">
    <a class="dropdown-item" href="../articles/BuildHector.html">Building Hector</a>
    <a class="dropdown-item" href="../articles/hector.html">Intro to Hector R interface</a>
    <a class="dropdown-item" href="../articles/Hector-Wider-World.html">Documentation manuscripts &amp; tutorials</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-examples">Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-examples">
    <a class="dropdown-item" href="../articles/hector.html">Example: Basic run and simple sensitivity anlaysis</a>
    <a class="dropdown-item" href="../articles/ex_hector_apply.html">Example: Using Hector to solve for an emissions pathway</a>
    <a class="dropdown-item" href="../articles/ex_multiple-biomes.html">Example: Running Hector with multiple biomes</a>
    <a class="dropdown-item" href="../articles/ex_carbon_tracking.html">Example: Carbon tracking with Hector</a>
    <a class="dropdown-item" href="../articles/ex_land_ocean_warming.html">Example: Changing Hector's land ocean warming ratio parameter</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/JGCRI/hector">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Carbon tracking with Hector</h1>
            <h3 data-toc-skip class="subtitle">R</h3>
                        <h4 data-toc-skip class="author">Leeya
Pressburger</h4>
            
            <h4 data-toc-skip class="date">2021-08-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/JGCRI/hector/blob/HEAD/vignettes/articles/ex_carbon_tracking.Rmd" class="external-link"><code>vignettes/articles/ex_carbon_tracking.Rmd</code></a></small>
      <div class="d-none name"><code>ex_carbon_tracking.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette will walk through Hector’s carbon tracking feature and
show how to turn on tracking, retrieve the tracking data, and display
the results. Additionally, the vignette demonstrates an application of
the carbon tracking feature and shows how to calculate the model’s
airborne fraction.</p>
<p>Hector’s carbon tracking feature helps to trace the movement of
carbon between various pools as the model runs. At the user-chosen start
date, each pool is deemed to be composed of 100% carbon from itself,
i.e. at that moment in time the deep ocean pool is 100% composed of
carbon from the deep pool.</p>
<p>As the model moves forward in time from the start date, Hector tracks
each pool’s fractional composition – i.e. the sources of its current
carbon. When the run is finished, this data can be read into R and then
analyzed.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, let’s load the packages we will need.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/JGCRI/hector" class="external-link">hector</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="carbon-tracking">Carbon tracking<a class="anchor" aria-label="anchor" href="#carbon-tracking"></a>
</h2>
<p>Now, we will read in an INI file and create a new core. In this
example, we will use SSP245.</p>
<p>In order to use the carbon tracking feature, we must use
<code>setvar</code> and <code>fetchvars</code>. <a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Command line users: to set a tracking start date, change
the &lt;code&gt;trackingDate=9999&lt;/code&gt; line in the &lt;code&gt;[core]&lt;/code&gt;
section of an INI scenario file.&lt;/p&gt;"><sup>1</sup></a> First, let’s look at
the <code>trackingDate</code> prior to setting it to any value.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inifile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span>,</span>
<span>                     <span class="st">"hector_ssp245.ini"</span><span class="op">)</span></span>
<span><span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">inifile</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">TRACKING_DATE</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              scenario year     variable value      units</span></span>
<span><span class="co">## 1 Unnamed Hector core   NA trackingDate  9999 (unitless)</span></span></code></pre>
<p>This returns the variable <code>trackingDate</code> with a
<code>value</code> of 9999. This default value does not turn carbon
tracking on (because the model never reaches year 9999).</p>
<p>Now, we will set a <code>trackingDate</code>, check that it worked,
and run a core. Let’s begin tracking in 1750. On that date, the model
will mark all carbon in each of its pools as originating in that pool:
the atmosphere will be 100% ‘atmosphere-origin’ C, the soil 100%
‘soil-origin’ C, etc.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">TRACKING_DATE</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">1750</span>, <span class="st">"(unitless)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fetchvars.html">fetchvars</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">TRACKING_DATE</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              scenario year     variable value      units</span></span>
<span><span class="co">## 1 Unnamed Hector core   NA trackingDate  1750 (unitless)</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Hector core: Unnamed Hector core</span></span>
<span><span class="co">## Start date:  1745</span></span>
<span><span class="co">## End date:    2300</span></span>
<span><span class="co">## Current date:    2300</span></span>
<span><span class="co">## Input file:  /home/runner/work/_temp/Library/hector/input/hector_ssp245.ini</span></span></code></pre>
<p>At this point, the model has been run. To retrieve the carbon
tracking data, we use the <code><a href="../reference/get_tracking_data.html">get_tracking_data()</a></code> function.
This returns a data frame which gives the current state of the pool, and
fractions of where the carbon is sourced from, at each model time point
after <code>trackingDate</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_tracking_data.html">get_tracking_data</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tdata</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   year component pool_name pool_value pool_units  source_name source_fraction</span></span>
<span><span class="co">## 1 1750     ocean        HL    150.050       Pg C    atmos_co2      0.00390956</span></span>
<span><span class="co">## 2 1750     ocean        HL    150.050       Pg C           HL      0.58577800</span></span>
<span><span class="co">## 3 1750     ocean        HL    150.050       Pg C intermediate      0.16750400</span></span>
<span><span class="co">## 4 1750     ocean        HL    150.050       Pg C           LL      0.24280900</span></span>
<span><span class="co">## 5 1750     ocean        LL    837.628       Pg C    atmos_co2      0.00000000</span></span>
<span><span class="co">## 6 1750     ocean        LL    837.628       Pg C           LL      0.91883400</span></span></code></pre>
<p>The <code>tdata</code> dataset now contains information on year (note
that the first year is the start-tracking date we asked for), the model
component, the name of the pool within that component, the amount of
carbon in the pool, and the fraction (0-1) of each source for that pool.
Importantly, the source fractions for a given pool and year will always
sum to 1.</p>
<p>Side note: the names in the carbon tracking data
(<code>pool_name</code>, <code>pool_value</code>, and
<code>pool_units</code>) differ from those used in the model’s standard
stream output (which are <code>variable</code>, <code>value</code>, and
<code>units</code> respectively). In contrast, <code>year</code> and
<code>component</code> are named identically in the two output
datasets.</p>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>By using <code>ggplot</code>, we can create time series graphs of how
the origin of one or more carbon pools in the model changes over
time.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">source_fraction</span>, fill <span class="op">=</span> <span class="va">source_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">pool_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">7</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Source Fraction"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Source Percentage Change Over Time"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex_carbon_tracking_files/figure-html/hector.plot1-1.png" width="672"></p>
<p>Let’s take a look at these graphs. Note that the <code>earth_c</code>
pool is always 100% <code>earth_c</code>: there are no inflows to this
pool in SSP245 (in contrast, in SSP19 there is direct-air carbon capture
and storage, so the <code>earth_c</code> pool origins will change). We
see that around 1800, human emissions (from <code>earth_c</code>) begin
to appear in pools such as <code>atmos_co2</code> or
<code>soil_c_global</code>. Between 1900-2000, human emissions take off
and become major sources by 2100.</p>
<p>Let’s examine just one pool:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">atmos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tdata</span>, <span class="va">pool_name</span> <span class="op">==</span> <span class="st">"atmos_co2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">atmos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">source_fraction</span>, fill <span class="op">=</span> <span class="va">source_name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_area</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">pool_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Source Fraction"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Source Percentage Change Over Time - Atmosphere"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex_carbon_tracking_files/figure-html/hector.atm-1.png" width="576"></p>
<p>This allows us to better examine the contributions by source to the
atmosphere.</p>
</div>
<div class="section level2">
<h2 id="example-airborne-fraction-calculation">Example: Airborne fraction calculation<a class="anchor" aria-label="anchor" href="#example-airborne-fraction-calculation"></a>
</h2>
<p>We can also use the tracking feature to calculate the airborne
fraction for a given point in time, or how much carbon emitted by humans
remains in the atmosphere as a fraction of total emissions as opposed to
being absorbed by the land or ocean.</p>
<p>First, we can define two functions. The first will run a core and
turn on tracking to return a data frame with results, including a column
for the source amount by pool (as opposed to the source fraction). The
second function will perform the airborne fraction calculation by
finding the amount of <code>earth_c</code> (human emissions) in the
<code>atmos_co2</code> (atmosphere) pool at the start and end date of
the run and dividing the difference by the difference in the
<code>earth_c</code> pool from the start of the run to the end, i.e. how
much carbon has left the <code>earth_c</code> pool.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tracking_results</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">inifile</span>, <span class="va">start</span>, <span class="va">stop</span>, <span class="va">tracking</span>, <span class="va">scenarioName</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Establish core, turn on tracking, run core</span></span>
<span>  <span class="va">core</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/newcore.html">newcore</a></span><span class="op">(</span><span class="va">inifile</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/setvar.html">setvar</a></span><span class="op">(</span><span class="va">core</span>, <span class="cn">NA</span>, <span class="fu"><a href="../reference/parameters.html">TRACKING_DATE</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">tracking</span>, <span class="st">"(unitless)"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/reset.html">reset</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get results, filter by correct years, add columns containing the amount</span></span>
<span>  <span class="co"># of carbon by source and the given scenario name</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_tracking_data.html">get_tracking_data</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span></span>
<span>  <span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">results</span>,</span>
<span>                    <span class="va">results</span><span class="op">$</span><span class="va">year</span> <span class="op">&gt;=</span> <span class="va">start</span> <span class="op">&amp;</span></span>
<span>                      <span class="va">results</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;=</span> <span class="va">stop</span><span class="op">)</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">source_amount</span> <span class="op">&lt;-</span> <span class="va">results</span><span class="op">$</span><span class="va">source_fraction</span> <span class="op">*</span> <span class="va">results</span><span class="op">$</span><span class="va">pool_value</span></span>
<span>  <span class="va">results</span><span class="op">$</span><span class="va">scenario_name</span> <span class="op">&lt;-</span> <span class="va">scenarioName</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">AF_calc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start</span>, <span class="va">results</span>, <span class="va">stop</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Isolate the atmos_co2 pool and earth_c source in start/end years</span></span>
<span>  <span class="va">atm_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">results</span>, <span class="va">results</span><span class="op">$</span><span class="va">pool_name</span> <span class="op">==</span> <span class="st">"atmos_co2"</span><span class="op">)</span></span>
<span>  <span class="va">atm_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">atm_c</span>, <span class="va">atm_c</span><span class="op">$</span><span class="va">source_name</span> <span class="op">==</span> <span class="st">"earth_c"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">atm_c1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">atm_c</span>, <span class="va">atm_c</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">start</span><span class="op">)</span></span>
<span>  <span class="va">atm_c2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">atm_c</span>, <span class="va">atm_c</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="va">stop</span><span class="op">)</span></span>
<span>  <span class="va">atm_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">atm_c1</span>, <span class="va">atm_c2</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate atmospheric uptake of Earth carbon</span></span>
<span>  <span class="va">atm_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">atm_c</span><span class="op">$</span><span class="va">source_amount</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">atm_c</span><span class="op">$</span><span class="va">source_amount</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Isolate earth_c pool and source in start/end years</span></span>
<span>  <span class="va">earth_c_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">results</span>,</span>
<span>                         <span class="va">results</span><span class="op">$</span><span class="va">pool_name</span> <span class="op">==</span> <span class="st">"earth_c"</span> <span class="op">&amp;</span></span>
<span>                           <span class="va">results</span><span class="op">$</span><span class="va">source_name</span> <span class="op">==</span> <span class="st">"earth_c"</span> <span class="op">&amp;</span></span>
<span>                           <span class="va">results</span><span class="op">$</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate change in Earth carbon</span></span>
<span>  <span class="va">earth_c_loss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">earth_c_loss</span><span class="op">$</span><span class="va">source_amount</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">earth_c_loss</span><span class="op">$</span><span class="va">source_amount</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Airborne fraction calculation</span></span>
<span>  <span class="va">AF</span> <span class="op">&lt;-</span> <span class="va">atm_c</span> <span class="op">/</span> <span class="va">earth_c_loss</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">AF</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, we will run our functions for the SSP245 scenario between 1750
and 2050 with tracking beginning at the start of the run. We can then
find the value of the airborne fraction in any year of the model run.
Let’s look at how the airborne fraction changes over time from 1950 to
2020 in ten year increments as well as the value in just the year
2020.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssp245</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"input"</span>, <span class="st">"hector_ssp245.ini"</span>, package <span class="op">=</span> <span class="st">"hector"</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">tracking_results</span><span class="op">(</span><span class="va">ssp245</span>, <span class="fl">1750</span>, <span class="fl">2050</span>, <span class="fl">1750</span>, <span class="st">"SSP245"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">years</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1950</span>, <span class="fl">2020</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">airborne_frac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>make.row.names <span class="op">=</span> <span class="va">years</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">years</span>, <span class="va">AF_calc</span>, <span class="va">results</span>, <span class="fl">1750</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">airborne_frac</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"AF"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">airborne_frac</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      year AF        </span></span>
<span><span class="co">## [8,] 2020 -0.8933551</span></span></code></pre>
<p>We see that the airborne fraction in 2020 is about -89%. In other
words, -89% of anthropogenic emissions remain in the atmosphere.</p>
<p>We can compare these values to a study published by W. Knorr in
2009.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Knorr, W. “Is the airborne fraction of anthropogenic
CO&lt;span class="math inline"&gt;\(_2\)&lt;/span&gt; emissions increasing?”
Geophysical Research Letters 36 (21). November 7, 2009. &lt;a href="http://dx.doi.org/10.1029/2009GL040613" class="external-link uri"&gt;http://dx.doi.org/10.1029/2009GL040613&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a>
Knorr computes seven values of airborne fractions in 2000 which we can
average. We can compute the difference between the maximum value and the
minimum to give an error range.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Knorr avg - values from Knorr 2009</span></span>
<span><span class="va">knorr_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>, <span class="fl">0.453</span>, <span class="fl">0.518</span>, <span class="fl">0.468</span>, <span class="fl">0.468</span>, <span class="fl">0.514</span>, <span class="fl">0.449</span><span class="op">)</span></span>
<span><span class="va">knorr_avg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">knorr_values</span><span class="op">)</span></span>
<span><span class="va">knorr_minmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">knorr_values</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">knorr_values</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Knorr avg"</span>, <span class="va">years</span><span class="op">)</span></span>
<span><span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">knorr_avg</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">airborne_frac</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">knorr_minmax</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">vars</span>, <span class="va">values</span>, <span class="va">error</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vars</span>, y <span class="op">=</span> <span class="va">values</span>, fill <span class="op">=</span> <span class="va">vars</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">values</span> <span class="op">-</span> <span class="va">error</span>, ymax <span class="op">=</span> <span class="va">values</span> <span class="op">+</span> <span class="va">error</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"paleturquoise3"</span>, <span class="st">"paleturquoise2"</span>, <span class="st">"paleturquoise1"</span>,</span>
<span>                               <span class="st">"darkslategray1"</span>, <span class="st">"darkslategray2"</span>, <span class="st">"darkslategray3"</span>,</span>
<span>                               <span class="st">"darkslategray4"</span>, <span class="st">"darkslategray"</span>, <span class="st">"grey50"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Year"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Airborne fraction over time"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Airborne Fraction Composition"</span><span class="op">)</span></span></code></pre></div>
<p><img src="ex_carbon_tracking_files/figure-html/hector.plot_AF-1.png" width="576"></p>
<p>The airborne fraction found in Hector is towards the lower end of the
range of values found by Knorr 2009, which varied from about 45% - 52%.
However, we see that the airborne fraction value from Hector remains
relatively constant over time at around 40%. This aligns with Knorr’s
conclusion that the airborne fraction shows no clear trend of increasing
or decreasing. Additionally, Hector’s value falls within the range of
CMIP models, as seen in Jones et al. 2013.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Jones et al. “Twenty-First-Century Compatible CO2
Emissions and Airborne Fraction Simulated by CMIP5 Earth System Models
under Four Representative Concentration Pathways.” Journal of Climate,
26 (13) p4398-4413. September 2021. &lt;a href="https://doi.org/10.1175/JCLI-D-12-00554.1" class="external-link uri"&gt;https://doi.org/10.1175/JCLI-D-12-00554.1&lt;/a&gt;&lt;/p&gt;'><sup>3</sup></a></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>The carbon tracking feature allows users to identify and trace the
composition by source of each pool in Hector. This is useful to, for
example, calculate the model’s airborne fraction.</p>
<p>Remember to shut down the core.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="fu"><a href="../reference/shutdown.html">shutdown</a></span><span class="op">(</span><span class="va">core</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Kalyn Dorheim, Ben Bond-Lamberty.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
